pipeline{
    agent any
    environment{
        CODE_REPO="https://github.com/hothaifa96/mangoapp"
        CODE_DIR= "mangoapp"
        IMAGE_NAME="mango"
        IMAGE_TAG="v${BUILD_NUMBER}"
    }
    stages{
        stage("clone the project"){
            steps{
                script{
                    sh "rm -fr ${CODE_DIR}"
                    sh "git clone ${CODE_REPO}"
                }
            }
        }

        stage("build docker image"){
            steps{
                script{
                    dir("${CODE_DIR}"){
                        sh "docker build -t ${IMAGE_NAME}:${IMAGE_TAG} ."
                    }
                }
            }
        }

        stage("push to ecr"){
            steps{
                script{
                    sh "docker images"
                }
            }
        }

    }
}